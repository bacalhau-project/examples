{"europe-west4-a":{"advanced_machine_features":[],"allow_stopping_for_update":null,"attached_disk":[],"boot_disk":[{"auto_delete":true,"device_name":"persistent-disk-0","disk_encryption_key_raw":"","disk_encryption_key_sha256":"","initialize_params":[{"image":"https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20230523","labels":{},"size":10,"type":"pd-standard"}],"kms_key_self_link":"","mode":"READ_WRITE","source":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/europe-west4-a/disks/europe-west4-a"}],"can_ip_forward":false,"confidential_instance_config":[],"cpu_platform":"Intel Skylake","current_status":"RUNNING","deletion_protection":false,"description":"","desired_status":null,"enable_display":false,"guest_accelerator":[],"hostname":"","id":"projects/bacalhau-duckdb-example/zones/europe-west4-a/instances/europe-west4-a","instance_id":"1377832615566053214","label_fingerprint":"42WmSpB8rSM=","labels":{},"machine_type":"n1-standard-2","metadata":{"ssh-keys":"daaronch:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local
","user-data":"Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"
MIME-Version: 1.0

--MIMEBOUNDARY
Content-Disposition: attachment; filename=\"cloud-config.yaml\"
Content-Transfer-Encoding: 7bit
Content-Type: text/cloud-config
Mime-Version: 1.0

#cloud-config
packages:
 - git
 - make
 - python3
 - python3-pip
 - curl
 - unzip

write_files:
 - encoding: b64
 content: |
 W1VuaXRdCkRlc2NyaXB0aW9uPUJhY2FsaGF1IERhZW1vbgpBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKV2FudHM9bmV0d29yay1vbmxpbmUudGFyZ2V0IHN5c3RlbWQtbmV0d29ya2Qtd2FpdC1vbmxpbmUuc2VydmljZQoKW1NlcnZpY2VdCkVudmlyb25tZW50PSJMT0dfVFlQRT1qc29uIgpFbnZpcm9ubWVudD0iQkFDQUxIQVVfUEFUSD0vZGF0YSIKRW52aXJvbm1lbnQ9IkJBQ0FMSEFVX0RJUj0vZGF0YSIKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz01cwpFeGVjU3RhcnQ9YmFzaCAvbm9kZS9zdGFydC1iYWNhbGhhdS5zaAoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0
 owner: root:root
 path: /etc/systemd/system/bacalhau.service
 permissions: \"0600\"
 - encoding: b64
 content: |
 IyEvYmluL2Jhc2gKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MxMDkxLFNDMjMxMixTQzIxNTUKc2V0IC1ldW8gcGlwZWZhaWwKSUZTPSQnXG5cdCcKCiMgd2Ugc3RhcnQgd2l0aCBub25lIGFzIHRoZSBkZWZhdWx0ICgibm9uZSIgcHJldmVudHMgdGhlIG5vZGUgY29ubmVjdGluZyB0byBvdXIgZGVmYXVsdCBib290c3RyYXAgbGlzdCkKZXhwb3J0IENPTk5FQ1RfUEVFUj0ibm9uZSIKCiMgU3BlY2lhbCBjYXNlIC0gZ2V0IHRhaWxzY2FsZSBhZGRyZXNzIGlmIGFueQpleHBvcnQgVEFJTFNDQUxFX0FERFJFU1M9JChpcCAtNCBhIGwgdGFpbHNjYWxlMCB8IGF3ayAnL2luZXQvIHtwcmludCAkMn0nIHwgY3V0IC1kLyAtZjEpCgojIGlmIFRBSUxTQ0FMRV9BRERSRVNTIGlzIHNldCwgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLW4gIiR7VEFJTFNDQUxFX0FERFJFU1N9IiBdXTsgdGhlbgogIGV4cG9ydCBCQUNBTEhBVV9QUkVGRVJSRURfQUREUkVTUz0iJHtUQUlMU0NBTEVfQUREUkVTU30iCmZpCgojIGlmIHRoZSBmaWxlIC9ldGMvYmFjYWxoYXUtYm9vdHN0cmFwIGV4aXN0cywgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLWYgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAgXV07IHRoZW4KICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzEwOTAKICBzb3VyY2UgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAKICBDT05ORUNUX1BFRVI9IiR7QkFDQUxIQVVfUEVFUl9DT05ORUNUfSIKZmkKCmJhY2FsaGF1IHNlcnZlIFwKICAtLW5vZGUtdHlwZSByZXF1ZXN0ZXIsY29tcHV0ZSBcCiAgLS1qb2Itc2VsZWN0aW9uLWRhdGEtbG9jYWxpdHkgYW55d2hlcmUgXAogIC0tc3dhcm0tcG9ydCAxMjM1IFwKICAtLWFwaS1wb3J0IDEyMzQgXAogIC0tcGVlciAiJHtDT05ORUNUX1BFRVJ9IiBcCiAgLS1wcml2YXRlLWludGVybmFsLWlwZnM9dHJ1ZQ==
 owner: root:root
 path: /node/start-bacalhau.sh
 permissions: \"0700\"
 - encoding: b64
 content: |
 /var/logs/aperitivo_logs/*.log {
 hourly
 rotate 1
 missingok
 notifempty
 compress
 olddir /var/logs/aperitivo_logs_to_process
 }
 owner: root:root
 path: /etc/logrotate.d/aperitivo
 permissions: \"0777\"
 - encoding: b64
 content: |
 [Unit]
 Description=Generate aperitivo logs
 After=network.target

 [Service]
 User=$USER
 WorkingDirectory=$PWD
 ExecStart=/usr/bin/python3 aW1wb3J0IGpzb24KaW1wb3J0IHRpbWUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSByYW5kb20gaW1wb3J0IGNob2ljZSwgY2hvaWNlcwppbXBvcnQgdXVpZAppbXBvcnQgYXJncGFyc2UKaW1wb3J0IG9zCmZyb20gZmFrZXIgaW1wb3J0IEZha2VyCgpmYWtlID0gRmFrZXIoKQoKCmRlZiBnZW5lcmF0ZV9sb2dfZW50cnkoKToKICAgIHNlcnZpY2VfbmFtZXMgPSBbIkF1dGgiLCAiQXBwU3RhY2siLCAiRGF0YWJhc2UiXQogICAgY2F0ZWdvcmllcyA9IFsiW0lORk9dIiwgIltXQVJOXSIsICJbQ1JJVElDQUxdIiwgIltTRUNVUklUWV0iXQoKICAgIHdpdGggb3BlbigiY2xlYW5fd29yZHNfYWxwaGEudHh0IiwgInIiKSBhcyB3b3JkX2ZpbGU6CiAgICAgICAgd29yZF9saXN0ID0gd29yZF9maWxlLnJlYWQoKS5zcGxpdGxpbmVzKCkKCiAgICBsb2dfZW50cnkgPSB7CiAgICAgICAgImlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIkB0aW1lc3RhbXAiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWZaIiksCiAgICAgICAgIkB2ZXJzaW9uIjogIjEuMSIsCiAgICAgICAgIm1lc3NhZ2UiOiBmIntjaG9pY2Uoc2VydmljZV9uYW1lcyl9IHtjaG9pY2UoY2F0ZWdvcmllcyl9IHsnICcuam9pbihjaG9pY2VzKHdvcmRfbGlzdCwgaz01KSl9IiwKICAgIH0KCiAgICByZXR1cm4gbG9nX2VudHJ5CgoKZGVmIG1haW4obG9nX2RpcmVjdG9yeSk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGxvZ19lbnRyeSA9IGdlbmVyYXRlX2xvZ19lbnRyeSgpCgogICAgICAgICMgTG9hZCBleGlzdGluZyBsb2cgZW50cmllcwogICAgICAgIGxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obG9nX2RpcmVjdG9yeSwgImZha2VfbG9ncy5sb2ciKQogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJyIikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgICAgICBsb2dfZW50cmllcyA9IGpzb24ubG9hZChsb2dfZmlsZSkKICAgICAgICBleGNlcHQgKEZpbGVOb3RGb3VuZEVycm9yLCBqc29uLkpTT05EZWNvZGVFcnJvcik6CiAgICAgICAgICAgIGxvZ19lbnRyaWVzID0gW10KCiAgICAgICAgIyBBcHBlbmQgbmV3IGxvZyBlbnRyeSBhbmQgd3JpdGUgYmFjayB0byB0aGUgZmlsZQogICAgICAgIGxvZ19lbnRyaWVzLmFwcGVuZChsb2dfZW50cnkpCiAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJ3IikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgIGpzb24uZHVtcChsb2dfZW50cmllcywgbG9nX2ZpbGUsIGluZGVudD0yKQoKICAgICAgICAjIFNsZWVwIGZvciA1IHNlY29uZHMgYmVmb3JlIGdlbmVyYXRpbmcgYW5vdGhlciBsb2cgZW50cnkKICAgICAgICB0aW1lLnNsZWVwKDUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJHZW5lcmF0ZSBmYWtlIGxvZyBlbnRyaWVzIGFuZCBzYXZlIHRoZW0gdG8gYSBzcGVjaWZpZWQgZGlyZWN0b3J5LiIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItZCIsICItLWRpcmVjdG9yeSIsIHR5cGU9c3RyLCByZXF1aXJlZD1UcnVlLCBoZWxwPSJUaGUgZGlyZWN0b3J5IHRvIHNhdmUgdGhlIGxvZyBmaWxlLiIpCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhhcmdzLmRpcmVjdG9yeSk6CiAgICAgICAgb3MubWFrZWRpcnMoYXJncy5kaXJlY3RvcnkpCgogICAgbWFpbihhcmdzLmRpcmVjdG9yeSkK -d /var/logs/aperitivo_logs
 Restart=always

 [Install]
 WantedBy=multi-user.target
 owner: root:root
 path: /etc/systemd/system/log-generator.service
 permissions: \"0644\"
 - encoding: b64
 content: |
 /usr/sbin/logrotate --hourly /etc/logrotate.conf
 owner: root:root
 path: /etc/cron.hourly/logrotate
 permissions: \"0700\"

package_update: true

runcmd:
 - echo \"Copying the SSH Key to the server\"
 - |
 echo -n \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local\" | awk 1 ORS=' ' \u003e\u003e /home/ubuntu/.ssh/authorized_keys
 #
 # Make node directory for all scripts
 #
 - mkdir -p /node
 - chmod 0700 /node
 #
 # Install tailscale
 #
 - |
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg\" | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg \u003e/dev/null
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.tailscale-keyring.list\" | sudo tee /etc/apt/sources.list.d/tailscale.list
 - apt-get update -y
 - apt -y install tailscale
 - sudo tailscale up --authkey tskey-auth-kp8XkM2CNTRL-pKF1jDfNrPB5gBsWs1QVVBWFujLckpJu --hostname bacalhau-duckdb-example-europe-west4-a-vm
 #
 # Install docker
 #
 - sudo apt-get install -y ca-certificates curl gnupg lsb-release
 - sudo mkdir -p /etc/apt/keyrings
 - |
 curl -fsSL \"https://download.docker.com/linux/ubuntu/gpg\" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null
 - sudo apt-get update -y
 - sudo apt -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
 #
 # Install IPFS
 #
 - wget https://dist.ipfs.io/go-ipfs/v0.9.1/go-ipfs_v0.9.1_linux-amd64.tar.gz
 - tar xvf go-ipfs_v0.9.1_linux-amd64.tar.gz
 - cd go-ipfs
 - sudo bash install.sh
 - ipfs init
 #
 # Install Bacalhau
 #
 - |
 curl -sL https://get.bacalhau.org/install.sh | bash
 # wait until bacalhau has been downloaded to /usr/local/bin/bacalhau
 - while [ ! -f /usr/local/bin/bacalhau ]; do sleep 1; done
 - echo \"Bacalhau downloaded.\"
 - sudo chmod +x /usr/local/bin/bacalhau
 # Create necessary directory
 - mkdir /var/logs/aperitivo_logs
 # Step 0b: Create the log rotation output directory
 - sudo mkdir -p /var/logs/aperitivo_logs_to_process
 # Step 0c: Create the /etc/cron.hourly/ directory and set appropriate permissions
 - sudo mkdir -p /etc/cron.hourly
 - sudo chown root:root /etc/cron.hourly
 - sudo chmod 755 /etc/cron.hourly
 # Reload the systemd daemon, enable, and start the service
 - sudo systemctl daemon-reload
 - sudo systemctl enable ipfs
 - sudo systemctl restart ipfs
 - sudo systemctl enable bacalhau.service
 - sudo systemctl restart bacalhau.service
 - sudo systemctl enable fake-log-generator.service
 - sudo systemctl start fake-log-generator.service

--MIMEBOUNDARY--
"},"metadata_fingerprint":"rI7BT7J_rqM=","metadata_startup_script":"","min_cpu_platform":"","name":"europe-west4-a","network_interface":[{"access_config":[{"nat_ip":"34.32.133.163","network_tier":"PREMIUM","public_ptr_domain_name":""}],"alias_ip_range":[],"ipv6_access_config":[],"ipv6_access_type":"","name":"nic0","network":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/global/networks/default","network_ip":"10.164.0.2","nic_type":"","stack_type":"IPV4_ONLY","subnetwork":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/regions/europe-west4/subnetworks/default","subnetwork_project":"bacalhau-duckdb-example"}],"project":"bacalhau-duckdb-example","reservation_affinity":[],"resource_policies":[],"scheduling":[{"automatic_restart":true,"min_node_cpus":0,"node_affinities":[],"on_host_maintenance":"MIGRATE","preemptible":false}],"scratch_disk":[],"self_link":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/europe-west4-a/instances/europe-west4-a","service_account":[{"email":"bacalhau-duckdb-example-sa@bacalhau-duckdb-example.iam.gserviceaccount.com","scopes":["https://www.googleapis.com/auth/cloud-platform"]}],"shielded_instance_config":[{"enable_integrity_monitoring":true,"enable_secure_boot":false,"enable_vtpm":true}],"tags":[],"tags_fingerprint":"42WmSpB8rSM=","timeouts":null,"zone":"europe-west4-a"},"europe-west9-b":{"advanced_machine_features":[],"allow_stopping_for_update":null,"attached_disk":[],"boot_disk":[{"auto_delete":true,"device_name":"persistent-disk-0","disk_encryption_key_raw":"","disk_encryption_key_sha256":"","initialize_params":[{"image":"https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20230523","labels":{},"size":10,"type":"pd-standard"}],"kms_key_self_link":"","mode":"READ_WRITE","source":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/europe-west9-b/disks/europe-west9-b"}],"can_ip_forward":false,"confidential_instance_config":[],"cpu_platform":"Intel Broadwell","current_status":"RUNNING","deletion_protection":false,"description":"","desired_status":null,"enable_display":false,"guest_accelerator":[],"hostname":"","id":"projects/bacalhau-duckdb-example/zones/europe-west9-b/instances/europe-west9-b","instance_id":"3205955938683157949","label_fingerprint":"42WmSpB8rSM=","labels":{},"machine_type":"e2-standard-2","metadata":{"ssh-keys":"daaronch:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local
","user-data":"Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"
MIME-Version: 1.0

--MIMEBOUNDARY
Content-Disposition: attachment; filename=\"cloud-config.yaml\"
Content-Transfer-Encoding: 7bit
Content-Type: text/cloud-config
Mime-Version: 1.0

#cloud-config
packages:
 - git
 - make
 - python3
 - python3-pip
 - curl
 - unzip

write_files:
 - encoding: b64
 content: |
 W1VuaXRdCkRlc2NyaXB0aW9uPUJhY2FsaGF1IERhZW1vbgpBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKV2FudHM9bmV0d29yay1vbmxpbmUudGFyZ2V0IHN5c3RlbWQtbmV0d29ya2Qtd2FpdC1vbmxpbmUuc2VydmljZQoKW1NlcnZpY2VdCkVudmlyb25tZW50PSJMT0dfVFlQRT1qc29uIgpFbnZpcm9ubWVudD0iQkFDQUxIQVVfUEFUSD0vZGF0YSIKRW52aXJvbm1lbnQ9IkJBQ0FMSEFVX0RJUj0vZGF0YSIKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz01cwpFeGVjU3RhcnQ9YmFzaCAvbm9kZS9zdGFydC1iYWNhbGhhdS5zaAoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0
 owner: root:root
 path: /etc/systemd/system/bacalhau.service
 permissions: \"0600\"
 - encoding: b64
 content: |
 IyEvYmluL2Jhc2gKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MxMDkxLFNDMjMxMixTQzIxNTUKc2V0IC1ldW8gcGlwZWZhaWwKSUZTPSQnXG5cdCcKCiMgd2Ugc3RhcnQgd2l0aCBub25lIGFzIHRoZSBkZWZhdWx0ICgibm9uZSIgcHJldmVudHMgdGhlIG5vZGUgY29ubmVjdGluZyB0byBvdXIgZGVmYXVsdCBib290c3RyYXAgbGlzdCkKZXhwb3J0IENPTk5FQ1RfUEVFUj0ibm9uZSIKCiMgU3BlY2lhbCBjYXNlIC0gZ2V0IHRhaWxzY2FsZSBhZGRyZXNzIGlmIGFueQpleHBvcnQgVEFJTFNDQUxFX0FERFJFU1M9JChpcCAtNCBhIGwgdGFpbHNjYWxlMCB8IGF3ayAnL2luZXQvIHtwcmludCAkMn0nIHwgY3V0IC1kLyAtZjEpCgojIGlmIFRBSUxTQ0FMRV9BRERSRVNTIGlzIHNldCwgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLW4gIiR7VEFJTFNDQUxFX0FERFJFU1N9IiBdXTsgdGhlbgogIGV4cG9ydCBCQUNBTEhBVV9QUkVGRVJSRURfQUREUkVTUz0iJHtUQUlMU0NBTEVfQUREUkVTU30iCmZpCgojIGlmIHRoZSBmaWxlIC9ldGMvYmFjYWxoYXUtYm9vdHN0cmFwIGV4aXN0cywgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLWYgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAgXV07IHRoZW4KICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzEwOTAKICBzb3VyY2UgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAKICBDT05ORUNUX1BFRVI9IiR7QkFDQUxIQVVfUEVFUl9DT05ORUNUfSIKZmkKCmJhY2FsaGF1IHNlcnZlIFwKICAtLW5vZGUtdHlwZSByZXF1ZXN0ZXIsY29tcHV0ZSBcCiAgLS1qb2Itc2VsZWN0aW9uLWRhdGEtbG9jYWxpdHkgYW55d2hlcmUgXAogIC0tc3dhcm0tcG9ydCAxMjM1IFwKICAtLWFwaS1wb3J0IDEyMzQgXAogIC0tcGVlciAiJHtDT05ORUNUX1BFRVJ9IiBcCiAgLS1wcml2YXRlLWludGVybmFsLWlwZnM9dHJ1ZQ==
 owner: root:root
 path: /node/start-bacalhau.sh
 permissions: \"0700\"
 - encoding: b64
 content: |
 /var/logs/aperitivo_logs/*.log {
 hourly
 rotate 1
 missingok
 notifempty
 compress
 olddir /var/logs/aperitivo_logs_to_process
 }
 owner: root:root
 path: /etc/logrotate.d/aperitivo
 permissions: \"0777\"
 - encoding: b64
 content: |
 [Unit]
 Description=Generate aperitivo logs
 After=network.target

 [Service]
 User=$USER
 WorkingDirectory=$PWD
 ExecStart=/usr/bin/python3 aW1wb3J0IGpzb24KaW1wb3J0IHRpbWUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSByYW5kb20gaW1wb3J0IGNob2ljZSwgY2hvaWNlcwppbXBvcnQgdXVpZAppbXBvcnQgYXJncGFyc2UKaW1wb3J0IG9zCmZyb20gZmFrZXIgaW1wb3J0IEZha2VyCgpmYWtlID0gRmFrZXIoKQoKCmRlZiBnZW5lcmF0ZV9sb2dfZW50cnkoKToKICAgIHNlcnZpY2VfbmFtZXMgPSBbIkF1dGgiLCAiQXBwU3RhY2siLCAiRGF0YWJhc2UiXQogICAgY2F0ZWdvcmllcyA9IFsiW0lORk9dIiwgIltXQVJOXSIsICJbQ1JJVElDQUxdIiwgIltTRUNVUklUWV0iXQoKICAgIHdpdGggb3BlbigiY2xlYW5fd29yZHNfYWxwaGEudHh0IiwgInIiKSBhcyB3b3JkX2ZpbGU6CiAgICAgICAgd29yZF9saXN0ID0gd29yZF9maWxlLnJlYWQoKS5zcGxpdGxpbmVzKCkKCiAgICBsb2dfZW50cnkgPSB7CiAgICAgICAgImlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIkB0aW1lc3RhbXAiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWZaIiksCiAgICAgICAgIkB2ZXJzaW9uIjogIjEuMSIsCiAgICAgICAgIm1lc3NhZ2UiOiBmIntjaG9pY2Uoc2VydmljZV9uYW1lcyl9IHtjaG9pY2UoY2F0ZWdvcmllcyl9IHsnICcuam9pbihjaG9pY2VzKHdvcmRfbGlzdCwgaz01KSl9IiwKICAgIH0KCiAgICByZXR1cm4gbG9nX2VudHJ5CgoKZGVmIG1haW4obG9nX2RpcmVjdG9yeSk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGxvZ19lbnRyeSA9IGdlbmVyYXRlX2xvZ19lbnRyeSgpCgogICAgICAgICMgTG9hZCBleGlzdGluZyBsb2cgZW50cmllcwogICAgICAgIGxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obG9nX2RpcmVjdG9yeSwgImZha2VfbG9ncy5sb2ciKQogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJyIikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgICAgICBsb2dfZW50cmllcyA9IGpzb24ubG9hZChsb2dfZmlsZSkKICAgICAgICBleGNlcHQgKEZpbGVOb3RGb3VuZEVycm9yLCBqc29uLkpTT05EZWNvZGVFcnJvcik6CiAgICAgICAgICAgIGxvZ19lbnRyaWVzID0gW10KCiAgICAgICAgIyBBcHBlbmQgbmV3IGxvZyBlbnRyeSBhbmQgd3JpdGUgYmFjayB0byB0aGUgZmlsZQogICAgICAgIGxvZ19lbnRyaWVzLmFwcGVuZChsb2dfZW50cnkpCiAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJ3IikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgIGpzb24uZHVtcChsb2dfZW50cmllcywgbG9nX2ZpbGUsIGluZGVudD0yKQoKICAgICAgICAjIFNsZWVwIGZvciA1IHNlY29uZHMgYmVmb3JlIGdlbmVyYXRpbmcgYW5vdGhlciBsb2cgZW50cnkKICAgICAgICB0aW1lLnNsZWVwKDUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJHZW5lcmF0ZSBmYWtlIGxvZyBlbnRyaWVzIGFuZCBzYXZlIHRoZW0gdG8gYSBzcGVjaWZpZWQgZGlyZWN0b3J5LiIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItZCIsICItLWRpcmVjdG9yeSIsIHR5cGU9c3RyLCByZXF1aXJlZD1UcnVlLCBoZWxwPSJUaGUgZGlyZWN0b3J5IHRvIHNhdmUgdGhlIGxvZyBmaWxlLiIpCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhhcmdzLmRpcmVjdG9yeSk6CiAgICAgICAgb3MubWFrZWRpcnMoYXJncy5kaXJlY3RvcnkpCgogICAgbWFpbihhcmdzLmRpcmVjdG9yeSkK -d /var/logs/aperitivo_logs
 Restart=always

 [Install]
 WantedBy=multi-user.target
 owner: root:root
 path: /etc/systemd/system/log-generator.service
 permissions: \"0644\"
 - encoding: b64
 content: |
 /usr/sbin/logrotate --hourly /etc/logrotate.conf
 owner: root:root
 path: /etc/cron.hourly/logrotate
 permissions: \"0700\"

package_update: true

runcmd:
 - echo \"Copying the SSH Key to the server\"
 - |
 echo -n \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local\" | awk 1 ORS=' ' \u003e\u003e /home/ubuntu/.ssh/authorized_keys
 #
 # Make node directory for all scripts
 #
 - mkdir -p /node
 - chmod 0700 /node
 #
 # Install tailscale
 #
 - |
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg\" | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg \u003e/dev/null
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.tailscale-keyring.list\" | sudo tee /etc/apt/sources.list.d/tailscale.list
 - apt-get update -y
 - apt -y install tailscale
 - sudo tailscale up --authkey tskey-auth-kp8XkM2CNTRL-pKF1jDfNrPB5gBsWs1QVVBWFujLckpJu --hostname bacalhau-duckdb-example-europe-west9-b-vm
 #
 # Install docker
 #
 - sudo apt-get install -y ca-certificates curl gnupg lsb-release
 - sudo mkdir -p /etc/apt/keyrings
 - |
 curl -fsSL \"https://download.docker.com/linux/ubuntu/gpg\" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null
 - sudo apt-get update -y
 - sudo apt -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
 #
 # Install IPFS
 #
 - wget https://dist.ipfs.io/go-ipfs/v0.9.1/go-ipfs_v0.9.1_linux-amd64.tar.gz
 - tar xvf go-ipfs_v0.9.1_linux-amd64.tar.gz
 - cd go-ipfs
 - sudo bash install.sh
 - ipfs init
 #
 # Install Bacalhau
 #
 - |
 curl -sL https://get.bacalhau.org/install.sh | bash
 # wait until bacalhau has been downloaded to /usr/local/bin/bacalhau
 - while [ ! -f /usr/local/bin/bacalhau ]; do sleep 1; done
 - echo \"Bacalhau downloaded.\"
 - sudo chmod +x /usr/local/bin/bacalhau
 # Create necessary directory
 - mkdir /var/logs/aperitivo_logs
 # Step 0b: Create the log rotation output directory
 - sudo mkdir -p /var/logs/aperitivo_logs_to_process
 # Step 0c: Create the /etc/cron.hourly/ directory and set appropriate permissions
 - sudo mkdir -p /etc/cron.hourly
 - sudo chown root:root /etc/cron.hourly
 - sudo chmod 755 /etc/cron.hourly
 # Reload the systemd daemon, enable, and start the service
 - sudo systemctl daemon-reload
 - sudo systemctl enable ipfs
 - sudo systemctl restart ipfs
 - sudo systemctl enable bacalhau.service
 - sudo systemctl restart bacalhau.service
 - sudo systemctl enable fake-log-generator.service
 - sudo systemctl start fake-log-generator.service

--MIMEBOUNDARY--
"},"metadata_fingerprint":"hIOPnuMlBZU=","metadata_startup_script":"","min_cpu_platform":"","name":"europe-west9-b","network_interface":[{"access_config":[{"nat_ip":"34.163.42.43","network_tier":"PREMIUM","public_ptr_domain_name":""}],"alias_ip_range":[],"ipv6_access_config":[],"ipv6_access_type":"","name":"nic0","network":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/global/networks/default","network_ip":"10.200.0.2","nic_type":"","stack_type":"IPV4_ONLY","subnetwork":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/regions/europe-west9/subnetworks/default","subnetwork_project":"bacalhau-duckdb-example"}],"project":"bacalhau-duckdb-example","reservation_affinity":[],"resource_policies":[],"scheduling":[{"automatic_restart":true,"min_node_cpus":0,"node_affinities":[],"on_host_maintenance":"MIGRATE","preemptible":false}],"scratch_disk":[],"self_link":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/europe-west9-b/instances/europe-west9-b","service_account":[{"email":"bacalhau-duckdb-example-sa@bacalhau-duckdb-example.iam.gserviceaccount.com","scopes":["https://www.googleapis.com/auth/cloud-platform"]}],"shielded_instance_config":[{"enable_integrity_monitoring":true,"enable_secure_boot":false,"enable_vtpm":true}],"tags":[],"tags_fingerprint":"42WmSpB8rSM=","timeouts":null,"zone":"europe-west9-b"},"us-central1-a":{"advanced_machine_features":[],"allow_stopping_for_update":null,"attached_disk":[],"boot_disk":[{"auto_delete":true,"device_name":"persistent-disk-0","disk_encryption_key_raw":"","disk_encryption_key_sha256":"","initialize_params":[{"image":"https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20230523","labels":{},"size":10,"type":"pd-standard"}],"kms_key_self_link":"","mode":"READ_WRITE","source":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/us-central1-a/disks/us-central1-a"}],"can_ip_forward":false,"confidential_instance_config":[],"cpu_platform":"Intel Haswell","current_status":"RUNNING","deletion_protection":false,"description":"","desired_status":null,"enable_display":false,"guest_accelerator":[],"hostname":"","id":"projects/bacalhau-duckdb-example/zones/us-central1-a/instances/us-central1-a","instance_id":"7840090269402992478","label_fingerprint":"42WmSpB8rSM=","labels":{},"machine_type":"n1-standard-2","metadata":{"ssh-keys":"daaronch:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local
","user-data":"Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"
MIME-Version: 1.0

--MIMEBOUNDARY
Content-Disposition: attachment; filename=\"cloud-config.yaml\"
Content-Transfer-Encoding: 7bit
Content-Type: text/cloud-config
Mime-Version: 1.0

#cloud-config
packages:
 - git
 - make
 - python3
 - python3-pip
 - curl
 - unzip

write_files:
 - encoding: b64
 content: |
 W1VuaXRdCkRlc2NyaXB0aW9uPUJhY2FsaGF1IERhZW1vbgpBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKV2FudHM9bmV0d29yay1vbmxpbmUudGFyZ2V0IHN5c3RlbWQtbmV0d29ya2Qtd2FpdC1vbmxpbmUuc2VydmljZQoKW1NlcnZpY2VdCkVudmlyb25tZW50PSJMT0dfVFlQRT1qc29uIgpFbnZpcm9ubWVudD0iQkFDQUxIQVVfUEFUSD0vZGF0YSIKRW52aXJvbm1lbnQ9IkJBQ0FMSEFVX0RJUj0vZGF0YSIKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz01cwpFeGVjU3RhcnQ9YmFzaCAvbm9kZS9zdGFydC1iYWNhbGhhdS5zaAoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0
 owner: root:root
 path: /etc/systemd/system/bacalhau.service
 permissions: \"0600\"
 - encoding: b64
 content: |
 IyEvYmluL2Jhc2gKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MxMDkxLFNDMjMxMixTQzIxNTUKc2V0IC1ldW8gcGlwZWZhaWwKSUZTPSQnXG5cdCcKCiMgd2Ugc3RhcnQgd2l0aCBub25lIGFzIHRoZSBkZWZhdWx0ICgibm9uZSIgcHJldmVudHMgdGhlIG5vZGUgY29ubmVjdGluZyB0byBvdXIgZGVmYXVsdCBib290c3RyYXAgbGlzdCkKZXhwb3J0IENPTk5FQ1RfUEVFUj0ibm9uZSIKCiMgU3BlY2lhbCBjYXNlIC0gZ2V0IHRhaWxzY2FsZSBhZGRyZXNzIGlmIGFueQpleHBvcnQgVEFJTFNDQUxFX0FERFJFU1M9JChpcCAtNCBhIGwgdGFpbHNjYWxlMCB8IGF3ayAnL2luZXQvIHtwcmludCAkMn0nIHwgY3V0IC1kLyAtZjEpCgojIGlmIFRBSUxTQ0FMRV9BRERSRVNTIGlzIHNldCwgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLW4gIiR7VEFJTFNDQUxFX0FERFJFU1N9IiBdXTsgdGhlbgogIGV4cG9ydCBCQUNBTEhBVV9QUkVGRVJSRURfQUREUkVTUz0iJHtUQUlMU0NBTEVfQUREUkVTU30iCmZpCgojIGlmIHRoZSBmaWxlIC9ldGMvYmFjYWxoYXUtYm9vdHN0cmFwIGV4aXN0cywgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLWYgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAgXV07IHRoZW4KICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzEwOTAKICBzb3VyY2UgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAKICBDT05ORUNUX1BFRVI9IiR7QkFDQUxIQVVfUEVFUl9DT05ORUNUfSIKZmkKCmJhY2FsaGF1IHNlcnZlIFwKICAtLW5vZGUtdHlwZSByZXF1ZXN0ZXIsY29tcHV0ZSBcCiAgLS1qb2Itc2VsZWN0aW9uLWRhdGEtbG9jYWxpdHkgYW55d2hlcmUgXAogIC0tc3dhcm0tcG9ydCAxMjM1IFwKICAtLWFwaS1wb3J0IDEyMzQgXAogIC0tcGVlciAiJHtDT05ORUNUX1BFRVJ9IiBcCiAgLS1wcml2YXRlLWludGVybmFsLWlwZnM9dHJ1ZQ==
 owner: root:root
 path: /node/start-bacalhau.sh
 permissions: \"0700\"
 - encoding: b64
 content: |
 /var/logs/aperitivo_logs/*.log {
 hourly
 rotate 1
 missingok
 notifempty
 compress
 olddir /var/logs/aperitivo_logs_to_process
 }
 owner: root:root
 path: /etc/logrotate.d/aperitivo
 permissions: \"0777\"
 - encoding: b64
 content: |
 [Unit]
 Description=Generate aperitivo logs
 After=network.target

 [Service]
 User=$USER
 WorkingDirectory=$PWD
 ExecStart=/usr/bin/python3 aW1wb3J0IGpzb24KaW1wb3J0IHRpbWUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSByYW5kb20gaW1wb3J0IGNob2ljZSwgY2hvaWNlcwppbXBvcnQgdXVpZAppbXBvcnQgYXJncGFyc2UKaW1wb3J0IG9zCmZyb20gZmFrZXIgaW1wb3J0IEZha2VyCgpmYWtlID0gRmFrZXIoKQoKCmRlZiBnZW5lcmF0ZV9sb2dfZW50cnkoKToKICAgIHNlcnZpY2VfbmFtZXMgPSBbIkF1dGgiLCAiQXBwU3RhY2siLCAiRGF0YWJhc2UiXQogICAgY2F0ZWdvcmllcyA9IFsiW0lORk9dIiwgIltXQVJOXSIsICJbQ1JJVElDQUxdIiwgIltTRUNVUklUWV0iXQoKICAgIHdpdGggb3BlbigiY2xlYW5fd29yZHNfYWxwaGEudHh0IiwgInIiKSBhcyB3b3JkX2ZpbGU6CiAgICAgICAgd29yZF9saXN0ID0gd29yZF9maWxlLnJlYWQoKS5zcGxpdGxpbmVzKCkKCiAgICBsb2dfZW50cnkgPSB7CiAgICAgICAgImlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIkB0aW1lc3RhbXAiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWZaIiksCiAgICAgICAgIkB2ZXJzaW9uIjogIjEuMSIsCiAgICAgICAgIm1lc3NhZ2UiOiBmIntjaG9pY2Uoc2VydmljZV9uYW1lcyl9IHtjaG9pY2UoY2F0ZWdvcmllcyl9IHsnICcuam9pbihjaG9pY2VzKHdvcmRfbGlzdCwgaz01KSl9IiwKICAgIH0KCiAgICByZXR1cm4gbG9nX2VudHJ5CgoKZGVmIG1haW4obG9nX2RpcmVjdG9yeSk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGxvZ19lbnRyeSA9IGdlbmVyYXRlX2xvZ19lbnRyeSgpCgogICAgICAgICMgTG9hZCBleGlzdGluZyBsb2cgZW50cmllcwogICAgICAgIGxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obG9nX2RpcmVjdG9yeSwgImZha2VfbG9ncy5sb2ciKQogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJyIikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgICAgICBsb2dfZW50cmllcyA9IGpzb24ubG9hZChsb2dfZmlsZSkKICAgICAgICBleGNlcHQgKEZpbGVOb3RGb3VuZEVycm9yLCBqc29uLkpTT05EZWNvZGVFcnJvcik6CiAgICAgICAgICAgIGxvZ19lbnRyaWVzID0gW10KCiAgICAgICAgIyBBcHBlbmQgbmV3IGxvZyBlbnRyeSBhbmQgd3JpdGUgYmFjayB0byB0aGUgZmlsZQogICAgICAgIGxvZ19lbnRyaWVzLmFwcGVuZChsb2dfZW50cnkpCiAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJ3IikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgIGpzb24uZHVtcChsb2dfZW50cmllcywgbG9nX2ZpbGUsIGluZGVudD0yKQoKICAgICAgICAjIFNsZWVwIGZvciA1IHNlY29uZHMgYmVmb3JlIGdlbmVyYXRpbmcgYW5vdGhlciBsb2cgZW50cnkKICAgICAgICB0aW1lLnNsZWVwKDUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJHZW5lcmF0ZSBmYWtlIGxvZyBlbnRyaWVzIGFuZCBzYXZlIHRoZW0gdG8gYSBzcGVjaWZpZWQgZGlyZWN0b3J5LiIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItZCIsICItLWRpcmVjdG9yeSIsIHR5cGU9c3RyLCByZXF1aXJlZD1UcnVlLCBoZWxwPSJUaGUgZGlyZWN0b3J5IHRvIHNhdmUgdGhlIGxvZyBmaWxlLiIpCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhhcmdzLmRpcmVjdG9yeSk6CiAgICAgICAgb3MubWFrZWRpcnMoYXJncy5kaXJlY3RvcnkpCgogICAgbWFpbihhcmdzLmRpcmVjdG9yeSkK -d /var/logs/aperitivo_logs
 Restart=always

 [Install]
 WantedBy=multi-user.target
 owner: root:root
 path: /etc/systemd/system/log-generator.service
 permissions: \"0644\"
 - encoding: b64
 content: |
 /usr/sbin/logrotate --hourly /etc/logrotate.conf
 owner: root:root
 path: /etc/cron.hourly/logrotate
 permissions: \"0700\"

package_update: true

runcmd:
 - echo \"Copying the SSH Key to the server\"
 - |
 echo -n \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local\" | awk 1 ORS=' ' \u003e\u003e /home/ubuntu/.ssh/authorized_keys
 #
 # Make node directory for all scripts
 #
 - mkdir -p /node
 - chmod 0700 /node
 #
 # Install tailscale
 #
 - |
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg\" | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg \u003e/dev/null
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.tailscale-keyring.list\" | sudo tee /etc/apt/sources.list.d/tailscale.list
 - apt-get update -y
 - apt -y install tailscale
 - sudo tailscale up --authkey tskey-auth-kp8XkM2CNTRL-pKF1jDfNrPB5gBsWs1QVVBWFujLckpJu --hostname bacalhau-duckdb-example-us-central1-a-vm
 #
 # Install docker
 #
 - sudo apt-get install -y ca-certificates curl gnupg lsb-release
 - sudo mkdir -p /etc/apt/keyrings
 - |
 curl -fsSL \"https://download.docker.com/linux/ubuntu/gpg\" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null
 - sudo apt-get update -y
 - sudo apt -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
 #
 # Install IPFS
 #
 - wget https://dist.ipfs.io/go-ipfs/v0.9.1/go-ipfs_v0.9.1_linux-amd64.tar.gz
 - tar xvf go-ipfs_v0.9.1_linux-amd64.tar.gz
 - cd go-ipfs
 - sudo bash install.sh
 - ipfs init
 #
 # Install Bacalhau
 #
 - |
 curl -sL https://get.bacalhau.org/install.sh | bash
 # wait until bacalhau has been downloaded to /usr/local/bin/bacalhau
 - while [ ! -f /usr/local/bin/bacalhau ]; do sleep 1; done
 - echo \"Bacalhau downloaded.\"
 - sudo chmod +x /usr/local/bin/bacalhau
 # Create necessary directory
 - mkdir /var/logs/aperitivo_logs
 # Step 0b: Create the log rotation output directory
 - sudo mkdir -p /var/logs/aperitivo_logs_to_process
 # Step 0c: Create the /etc/cron.hourly/ directory and set appropriate permissions
 - sudo mkdir -p /etc/cron.hourly
 - sudo chown root:root /etc/cron.hourly
 - sudo chmod 755 /etc/cron.hourly
 # Reload the systemd daemon, enable, and start the service
 - sudo systemctl daemon-reload
 - sudo systemctl enable ipfs
 - sudo systemctl restart ipfs
 - sudo systemctl enable bacalhau.service
 - sudo systemctl restart bacalhau.service
 - sudo systemctl enable fake-log-generator.service
 - sudo systemctl start fake-log-generator.service

--MIMEBOUNDARY--
"},"metadata_fingerprint":"fNy8bUkd4po=","metadata_startup_script":"","min_cpu_platform":"","name":"us-central1-a","network_interface":[{"access_config":[{"nat_ip":"34.27.114.123","network_tier":"PREMIUM","public_ptr_domain_name":""}],"alias_ip_range":[],"ipv6_access_config":[],"ipv6_access_type":"","name":"nic0","network":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/global/networks/default","network_ip":"10.128.0.2","nic_type":"","stack_type":"IPV4_ONLY","subnetwork":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/regions/us-central1/subnetworks/default","subnetwork_project":"bacalhau-duckdb-example"}],"project":"bacalhau-duckdb-example","reservation_affinity":[],"resource_policies":[],"scheduling":[{"automatic_restart":true,"min_node_cpus":0,"node_affinities":[],"on_host_maintenance":"MIGRATE","preemptible":false}],"scratch_disk":[],"self_link":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/us-central1-a/instances/us-central1-a","service_account":[{"email":"bacalhau-duckdb-example-sa@bacalhau-duckdb-example.iam.gserviceaccount.com","scopes":["https://www.googleapis.com/auth/cloud-platform"]}],"shielded_instance_config":[{"enable_integrity_monitoring":true,"enable_secure_boot":false,"enable_vtpm":true}],"tags":[],"tags_fingerprint":"42WmSpB8rSM=","timeouts":null,"zone":"us-central1-a"},"us-east1-b":{"advanced_machine_features":[],"allow_stopping_for_update":null,"attached_disk":[],"boot_disk":[{"auto_delete":true,"device_name":"persistent-disk-0","disk_encryption_key_raw":"","disk_encryption_key_sha256":"","initialize_params":[{"image":"https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20230523","labels":{},"size":10,"type":"pd-standard"}],"kms_key_self_link":"","mode":"READ_WRITE","source":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/us-east1-b/disks/us-east1-b"}],"can_ip_forward":false,"confidential_instance_config":[],"cpu_platform":"Intel Haswell","current_status":"RUNNING","deletion_protection":false,"description":"","desired_status":null,"enable_display":false,"guest_accelerator":[],"hostname":"","id":"projects/bacalhau-duckdb-example/zones/us-east1-b/instances/us-east1-b","instance_id":"2226774618637799262","label_fingerprint":"42WmSpB8rSM=","labels":{},"machine_type":"n1-standard-2","metadata":{"ssh-keys":"daaronch:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local
","user-data":"Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"
MIME-Version: 1.0

--MIMEBOUNDARY
Content-Disposition: attachment; filename=\"cloud-config.yaml\"
Content-Transfer-Encoding: 7bit
Content-Type: text/cloud-config
Mime-Version: 1.0

#cloud-config
packages:
 - git
 - make
 - python3
 - python3-pip
 - curl
 - unzip

write_files:
 - encoding: b64
 content: |
 W1VuaXRdCkRlc2NyaXB0aW9uPUJhY2FsaGF1IERhZW1vbgpBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKV2FudHM9bmV0d29yay1vbmxpbmUudGFyZ2V0IHN5c3RlbWQtbmV0d29ya2Qtd2FpdC1vbmxpbmUuc2VydmljZQoKW1NlcnZpY2VdCkVudmlyb25tZW50PSJMT0dfVFlQRT1qc29uIgpFbnZpcm9ubWVudD0iQkFDQUxIQVVfUEFUSD0vZGF0YSIKRW52aXJvbm1lbnQ9IkJBQ0FMSEFVX0RJUj0vZGF0YSIKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz01cwpFeGVjU3RhcnQ9YmFzaCAvbm9kZS9zdGFydC1iYWNhbGhhdS5zaAoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0
 owner: root:root
 path: /etc/systemd/system/bacalhau.service
 permissions: \"0600\"
 - encoding: b64
 content: |
 IyEvYmluL2Jhc2gKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MxMDkxLFNDMjMxMixTQzIxNTUKc2V0IC1ldW8gcGlwZWZhaWwKSUZTPSQnXG5cdCcKCiMgd2Ugc3RhcnQgd2l0aCBub25lIGFzIHRoZSBkZWZhdWx0ICgibm9uZSIgcHJldmVudHMgdGhlIG5vZGUgY29ubmVjdGluZyB0byBvdXIgZGVmYXVsdCBib290c3RyYXAgbGlzdCkKZXhwb3J0IENPTk5FQ1RfUEVFUj0ibm9uZSIKCiMgU3BlY2lhbCBjYXNlIC0gZ2V0IHRhaWxzY2FsZSBhZGRyZXNzIGlmIGFueQpleHBvcnQgVEFJTFNDQUxFX0FERFJFU1M9JChpcCAtNCBhIGwgdGFpbHNjYWxlMCB8IGF3ayAnL2luZXQvIHtwcmludCAkMn0nIHwgY3V0IC1kLyAtZjEpCgojIGlmIFRBSUxTQ0FMRV9BRERSRVNTIGlzIHNldCwgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLW4gIiR7VEFJTFNDQUxFX0FERFJFU1N9IiBdXTsgdGhlbgogIGV4cG9ydCBCQUNBTEhBVV9QUkVGRVJSRURfQUREUkVTUz0iJHtUQUlMU0NBTEVfQUREUkVTU30iCmZpCgojIGlmIHRoZSBmaWxlIC9ldGMvYmFjYWxoYXUtYm9vdHN0cmFwIGV4aXN0cywgdXNlIGl0IHRvIHBvcHVsYXRlIHRoZSBDT05ORUNUX1BFRVIgdmFyaWFibGUKaWYgW1sgLWYgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAgXV07IHRoZW4KICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzEwOTAKICBzb3VyY2UgL2V0Yy9iYWNhbGhhdS1ib290c3RyYXAKICBDT05ORUNUX1BFRVI9IiR7QkFDQUxIQVVfUEVFUl9DT05ORUNUfSIKZmkKCmJhY2FsaGF1IHNlcnZlIFwKICAtLW5vZGUtdHlwZSByZXF1ZXN0ZXIsY29tcHV0ZSBcCiAgLS1qb2Itc2VsZWN0aW9uLWRhdGEtbG9jYWxpdHkgYW55d2hlcmUgXAogIC0tc3dhcm0tcG9ydCAxMjM1IFwKICAtLWFwaS1wb3J0IDEyMzQgXAogIC0tcGVlciAiJHtDT05ORUNUX1BFRVJ9IiBcCiAgLS1wcml2YXRlLWludGVybmFsLWlwZnM9dHJ1ZQ==
 owner: root:root
 path: /node/start-bacalhau.sh
 permissions: \"0700\"
 - encoding: b64
 content: |
 /var/logs/aperitivo_logs/*.log {
 hourly
 rotate 1
 missingok
 notifempty
 compress
 olddir /var/logs/aperitivo_logs_to_process
 }
 owner: root:root
 path: /etc/logrotate.d/aperitivo
 permissions: \"0777\"
 - encoding: b64
 content: |
 [Unit]
 Description=Generate aperitivo logs
 After=network.target

 [Service]
 User=$USER
 WorkingDirectory=$PWD
 ExecStart=/usr/bin/python3 aW1wb3J0IGpzb24KaW1wb3J0IHRpbWUKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSByYW5kb20gaW1wb3J0IGNob2ljZSwgY2hvaWNlcwppbXBvcnQgdXVpZAppbXBvcnQgYXJncGFyc2UKaW1wb3J0IG9zCmZyb20gZmFrZXIgaW1wb3J0IEZha2VyCgpmYWtlID0gRmFrZXIoKQoKCmRlZiBnZW5lcmF0ZV9sb2dfZW50cnkoKToKICAgIHNlcnZpY2VfbmFtZXMgPSBbIkF1dGgiLCAiQXBwU3RhY2siLCAiRGF0YWJhc2UiXQogICAgY2F0ZWdvcmllcyA9IFsiW0lORk9dIiwgIltXQVJOXSIsICJbQ1JJVElDQUxdIiwgIltTRUNVUklUWV0iXQoKICAgIHdpdGggb3BlbigiY2xlYW5fd29yZHNfYWxwaGEudHh0IiwgInIiKSBhcyB3b3JkX2ZpbGU6CiAgICAgICAgd29yZF9saXN0ID0gd29yZF9maWxlLnJlYWQoKS5zcGxpdGxpbmVzKCkKCiAgICBsb2dfZW50cnkgPSB7CiAgICAgICAgImlkIjogc3RyKHV1aWQudXVpZDQoKSksCiAgICAgICAgIkB0aW1lc3RhbXAiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiJVktJW0tJWRUJUg6JU06JVMuJWZaIiksCiAgICAgICAgIkB2ZXJzaW9uIjogIjEuMSIsCiAgICAgICAgIm1lc3NhZ2UiOiBmIntjaG9pY2Uoc2VydmljZV9uYW1lcyl9IHtjaG9pY2UoY2F0ZWdvcmllcyl9IHsnICcuam9pbihjaG9pY2VzKHdvcmRfbGlzdCwgaz01KSl9IiwKICAgIH0KCiAgICByZXR1cm4gbG9nX2VudHJ5CgoKZGVmIG1haW4obG9nX2RpcmVjdG9yeSk6CiAgICB3aGlsZSBUcnVlOgogICAgICAgIGxvZ19lbnRyeSA9IGdlbmVyYXRlX2xvZ19lbnRyeSgpCgogICAgICAgICMgTG9hZCBleGlzdGluZyBsb2cgZW50cmllcwogICAgICAgIGxvZ19maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4obG9nX2RpcmVjdG9yeSwgImZha2VfbG9ncy5sb2ciKQogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJyIikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgICAgICBsb2dfZW50cmllcyA9IGpzb24ubG9hZChsb2dfZmlsZSkKICAgICAgICBleGNlcHQgKEZpbGVOb3RGb3VuZEVycm9yLCBqc29uLkpTT05EZWNvZGVFcnJvcik6CiAgICAgICAgICAgIGxvZ19lbnRyaWVzID0gW10KCiAgICAgICAgIyBBcHBlbmQgbmV3IGxvZyBlbnRyeSBhbmQgd3JpdGUgYmFjayB0byB0aGUgZmlsZQogICAgICAgIGxvZ19lbnRyaWVzLmFwcGVuZChsb2dfZW50cnkpCiAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlX3BhdGgsICJ3IikgYXMgbG9nX2ZpbGU6CiAgICAgICAgICAgIGpzb24uZHVtcChsb2dfZW50cmllcywgbG9nX2ZpbGUsIGluZGVudD0yKQoKICAgICAgICAjIFNsZWVwIGZvciA1IHNlY29uZHMgYmVmb3JlIGdlbmVyYXRpbmcgYW5vdGhlciBsb2cgZW50cnkKICAgICAgICB0aW1lLnNsZWVwKDUpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHBhcnNlciA9IGFyZ3BhcnNlLkFyZ3VtZW50UGFyc2VyKGRlc2NyaXB0aW9uPSJHZW5lcmF0ZSBmYWtlIGxvZyBlbnRyaWVzIGFuZCBzYXZlIHRoZW0gdG8gYSBzcGVjaWZpZWQgZGlyZWN0b3J5LiIpCiAgICBwYXJzZXIuYWRkX2FyZ3VtZW50KCItZCIsICItLWRpcmVjdG9yeSIsIHR5cGU9c3RyLCByZXF1aXJlZD1UcnVlLCBoZWxwPSJUaGUgZGlyZWN0b3J5IHRvIHNhdmUgdGhlIGxvZyBmaWxlLiIpCiAgICBhcmdzID0gcGFyc2VyLnBhcnNlX2FyZ3MoKQoKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhhcmdzLmRpcmVjdG9yeSk6CiAgICAgICAgb3MubWFrZWRpcnMoYXJncy5kaXJlY3RvcnkpCgogICAgbWFpbihhcmdzLmRpcmVjdG9yeSkK -d /var/logs/aperitivo_logs
 Restart=always

 [Install]
 WantedBy=multi-user.target
 owner: root:root
 path: /etc/systemd/system/log-generator.service
 permissions: \"0644\"
 - encoding: b64
 content: |
 /usr/sbin/logrotate --hourly /etc/logrotate.conf
 owner: root:root
 path: /etc/cron.hourly/logrotate
 permissions: \"0700\"

package_update: true

runcmd:
 - echo \"Copying the SSH Key to the server\"
 - |
 echo -n \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCwnI8SXvegMuYRTe0W5qtSjeFRNTtNhe5qZ+ZOZDd4IZ2B78IfQ8aTlGDnpNJ3oknNouxbr6oFOu5fmqaQ+sArI0tv+OMojIsMnWT6PLQbf6lsmUsDZaO8SV7eznS10GESFSTIqDj5ku85QSx/yZ/imiUsaWtPpqyCPhezyS+TDG3kdJ/ahV9sXF3eYu+kv7tu9K158GuyFLMvJdamDJTzK80n8o/7ALvR6rfCLIGojv2FEub58HaYw57DDmHdFQtH4FhADRoBxfV7fI65WSLd2MXXPYxF8LyhGgYN8HGCUGpzN5SAmu+AyUUsCikfhmzFO+L4O/ARvCnDw5HJ0YUoUJSxXqS6HUSBO9vQq6tELFCnsUV4hu1WU+32rrqNp2o7gxdY4g6tA0zjaHJ0PiommEwEpucuMPNui4W4TorGH2IE2+ZcVpEDsXrgcU9xh3aQ202bhZn/tfCy3WuufSPnZEksp+Zzt7SrvxZayTm+0q4/cpdEslKqKrAAqFLn/QE= daaaronch@Davids-MacBook-Pro.local\" | awk 1 ORS=' ' \u003e\u003e /home/ubuntu/.ssh/authorized_keys
 #
 # Make node directory for all scripts
 #
 - mkdir -p /node
 - chmod 0700 /node
 #
 # Install tailscale
 #
 - |
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg\" | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg \u003e/dev/null
 sudo curl -fsSL \"https://pkgs.tailscale.com/stable/ubuntu/jammy.tailscale-keyring.list\" | sudo tee /etc/apt/sources.list.d/tailscale.list
 - apt-get update -y
 - apt -y install tailscale
 - sudo tailscale up --authkey tskey-auth-kp8XkM2CNTRL-pKF1jDfNrPB5gBsWs1QVVBWFujLckpJu --hostname bacalhau-duckdb-example-us-east1-b-vm
 #
 # Install docker
 #
 - sudo apt-get install -y ca-certificates curl gnupg lsb-release
 - sudo mkdir -p /etc/apt/keyrings
 - |
 curl -fsSL \"https://download.docker.com/linux/ubuntu/gpg\" | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
 echo \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list \u003e /dev/null
 - sudo apt-get update -y
 - sudo apt -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
 #
 # Install IPFS
 #
 - wget https://dist.ipfs.io/go-ipfs/v0.9.1/go-ipfs_v0.9.1_linux-amd64.tar.gz
 - tar xvf go-ipfs_v0.9.1_linux-amd64.tar.gz
 - cd go-ipfs
 - sudo bash install.sh
 - ipfs init
 #
 # Install Bacalhau
 #
 - |
 curl -sL https://get.bacalhau.org/install.sh | bash
 # wait until bacalhau has been downloaded to /usr/local/bin/bacalhau
 - while [ ! -f /usr/local/bin/bacalhau ]; do sleep 1; done
 - echo \"Bacalhau downloaded.\"
 - sudo chmod +x /usr/local/bin/bacalhau
 # Create necessary directory
 - mkdir /var/logs/aperitivo_logs
 # Step 0b: Create the log rotation output directory
 - sudo mkdir -p /var/logs/aperitivo_logs_to_process
 # Step 0c: Create the /etc/cron.hourly/ directory and set appropriate permissions
 - sudo mkdir -p /etc/cron.hourly
 - sudo chown root:root /etc/cron.hourly
 - sudo chmod 755 /etc/cron.hourly
 # Reload the systemd daemon, enable, and start the service
 - sudo systemctl daemon-reload
 - sudo systemctl enable ipfs
 - sudo systemctl restart ipfs
 - sudo systemctl enable bacalhau.service
 - sudo systemctl restart bacalhau.service
 - sudo systemctl enable fake-log-generator.service
 - sudo systemctl start fake-log-generator.service

--MIMEBOUNDARY--
"},"metadata_fingerprint":"rWivLGdXDVU=","metadata_startup_script":"","min_cpu_platform":"","name":"us-east1-b","network_interface":[{"access_config":[{"nat_ip":"34.23.208.101","network_tier":"PREMIUM","public_ptr_domain_name":""}],"alias_ip_range":[],"ipv6_access_config":[],"ipv6_access_type":"","name":"nic0","network":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/global/networks/default","network_ip":"10.142.0.2","nic_type":"","stack_type":"IPV4_ONLY","subnetwork":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/regions/us-east1/subnetworks/default","subnetwork_project":"bacalhau-duckdb-example"}],"project":"bacalhau-duckdb-example","reservation_affinity":[],"resource_policies":[],"scheduling":[{"automatic_restart":true,"min_node_cpus":0,"node_affinities":[],"on_host_maintenance":"MIGRATE","preemptible":false}],"scratch_disk":[],"self_link":"https://www.googleapis.com/compute/v1/projects/bacalhau-duckdb-example/zones/us-east1-b/instances/us-east1-b","service_account":[{"email":"bacalhau-duckdb-example-sa@bacalhau-duckdb-example.iam.gserviceaccount.com","scopes":["https://www.googleapis.com/auth/cloud-platform"]}],"shielded_instance_config":[{"enable_integrity_monitoring":true,"enable_secure_boot":false,"enable_vtpm":true}],"tags":[],"tags_fingerprint":"42WmSpB8rSM=","timeouts":null,"zone":"us-east1-b"}}
"us-central1-a"
"europe-west9-b"
"europe-west4-a"
"us-east1-b"
