<!-- Generated by SpecStory -->

# AWS Spot Instance Management Discussion (2025-03-03 10:45:48)

_**User**_

here is the context of what we are working on



---

_**Assistant**_

Based on the provided code and context, I understand you're working on a Python script (`deploy_spot.py`) that manages AWS spot instances for a Bacalhau cluster. The script has been experiencing issues with AWS SSO credential handling and timeouts.

Here's a summary of the key functionality:

1. **Main Features**:
   - Creates, lists, and destroys AWS spot instances across multiple regions
   - Manages VPC resources (subnets, security groups, internet gateways)
   - Handles Bacalhau node management
   - Provides real-time status updates via a live console display

2. **Recent Improvements**:
   - Added AWS API timeout handling (configurable via `--timeout`)
   - Implemented better error handling for SSO/credential issues
   - Added graceful cancellation handling
   - Improved status updates during operations

3. **Key Components**:
   - Uses `asyncio` for concurrent operations
   - Integrates with AWS boto3 for EC2 management
   - Provides both interactive and JSON output formats
   - Includes VPC resource cleanup
   - Manages Bacalhau node lifecycle

4. **Available Actions**:
   - `create`: Launch new spot instances
   - `destroy`: Terminate instances and clean up resources
   - `list`: Show current instances
   - `delete_disconnected_aws_nodes`: Clean up disconnected Bacalhau nodes

Would you like me to:
1. Help debug a specific issue?
2. Implement additional features?
3. Optimize certain parts of the code?
4. Explain how specific components work?

Please let me know what specific aspect you'd like to focus on.

---



---

