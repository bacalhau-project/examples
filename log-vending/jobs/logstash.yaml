Name: Logstash
Type: daemon
Namespace: logging
Constraints:
  - Key: service
    Operator: ==
    Values:
      - web-server
Tasks:
  - Name: main
    Engine:
      Type: docker
      Params:
        Image: expanso/nginx-access-log-agent@sha256:72685a4e54d028c0d6d5f9bafdcf76ecc4dae258ec91971d4b850d0414bf43f9
        EnvironmentVariables:
          - ES_HOST=https://search-bacalhauopensea-ihc4r0qjflma-ntnma3yh6ay33uitdpcrgcgrsi.eu-west-1.es.amazonaws.com:443
          - S3_BUCKET=bacalhaulogvending-bucket83908e77-ncvj2ymuvtgd
          - AWS_REGION=eu-west-1
          - AGGREGATE_DURATION=10
    Resources:
      CPU: 1
      Memory: 5Gi
    Network: 
      Type: Full
    InputSources:
      - Target: /app/logs
        Source:
          Type: localDirectory
          Params:
            SourcePath: /data/log-vending/logs
      - Target: /app/state
        Source:
          Type: localDirectory
          Params:
            SourcePath: /data/log-vending/state
            ReadWrite: true