Name: Query logs - 5xx status codes
Type: ops
Tasks:
  - Name: main
    Engine:
      Type: docker
      Params:
        Image: ghcr.io/bacalhau-project/nginx-access-log-query:1.0.0
        Parameters:
          - --query
          - SELECT status FROM logs WHERE status LIKE '5__'

    # InputSources lists remote artifacts that should be downloaded before task execution and mounted within the task
    # Here we are mounting the logs directory to /app/output
    InputSources:
      - Target: /logs
        Source:
          Type: localDirectory
          Params:
            SourcePath: /data/log-processing/logs
            ReadWrite: true

    # Publisher specifies where the results of the task should be published - S3, IPFS, Local or none
    # Here we are publishing the results to the MinIO "logs-bucket" bucket
    Publisher:
      Type: "s3"
      Params:
        Bucket: "logs-bucket"
        Key: "jobs/{jobID}/{executionID}"
        Endpoint: "http://storage:9000"
        Region: "us-east-1"
